<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>upload test</title>
    <style>
        body {
            font-family: 'Malgun Gothic', sans-serif;
        }
        /* í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 15px;
        }

        /* í…Œì´ë¸” í—¤ë” ìŠ¤íƒ€ì¼ */
        th {
            background-color: #4CAF50;
            color: white;
            padding: 10px;
            text-align: left;
            font-size: 15px; /* í°íŠ¸ í¬ê¸° ì„¤ì • */
        }

        /* í…Œì´ë¸” ë°ì´í„° ì…€ ìŠ¤íƒ€ì¼ */
        td {
            padding: 10px;
            border: 1px solid #ddd;
            font-size: 15px; /* í°íŠ¸ í¬ê¸° ì„¤ì • */
        }

        /* í–‰ì— ë§ˆìš°ìŠ¤ë¥¼ ì˜¬ë¦´ ë•Œ */
        tr:hover {
            background-color: #f1f1f1;
        }

        /* í…Œì´ë¸”ì— í…Œë‘ë¦¬ ìŠ¤íƒ€ì¼ */
        table, th, td {
            border: 1px solid #ddd;
        }

        /* ë¬¸ì„œì™€ ìœ ì‚¬ë„ í—¤ë” í–‰ ë¶€ë¶„ë§Œ ì´ˆë¡ìƒ‰ */
        tr:nth-child(1) {
            background-color: #4CAF50;
            color: white;
        }

        /* ë‚´ìš©ìš”ì•½ ìŠ¤íƒ€ì¼ */
        #doc-answer {
            font-size: 16px;
            color: #255fb6;
            margin-bottom: 15px;
            font-family: 'Malgun Gothic', sans-serif;
            border: 1px solid #ddd;
            padding: 10px;
        }
        /* ì²˜ë¦¬ì‹œê°„ ìŠ¤íƒ€ì¼ */
        #total-time {
            font-size: 15px;
            color: #0c0501;
            margin-bottom: 15px;
            font-family: 'Malgun Gothic', sans-serif;
        }
        /* ë¬¸ì„œíŒŒì¼ëª… ìŠ¤íƒ€ì¼ */
        #doc-filename {
            font-size: 20px;
            color: #080400;
            font-weight: bold;
            margin-bottom: 15px;
            font-family: 'Malgun Gothic', sans-serif;
        }
        button {
            padding: 10px 20px;
            margin-left: 10px;
            background-color: #4CAF50;
            color: #fff;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-bottom: 15px;
            font-family: 'Malgun Gothic', sans-serif;
        }
    </style>
    <script>
        window.onload = function() {

            // íŒŒì¼ë„¤ì„ ì¶œë ¥
            const filename = "ğŸ“Œ "+"{{filename}}"
            document.getElementById("doc-filename").innerHTML = filename;

            // ì‹œê°„ ê³¼ í´ë”ê²½ë¡œ ì¶œë ¥
            const time = "{{time}}"
            // ë¡œì»¬íŒŒì¼ì´ ìˆëŠ” í´ë”ê²½ë¡œ ì–»ì–´ì˜´.
			const local_folder_path = "{{local_folder_path}}" + "/";
            document.getElementById("total-time").innerHTML = "â°: " + time + " ì´ˆ, ğŸ“‚: " + local_folder_path;
            
            // ë‚´ìš©ìš”ì•½ì„ ì¶œë ¥
            const answer = "{{answer}}"
            document.getElementById("doc-answer").innerHTML = answer;

			
            // {response} ê°’ì„ ì…ë ¥ ë°›ìŒ. 
            //  ì˜ˆ:[{&#39;rfile_name&#39;: &#39;1.ìœ„ì„ì „ê²°ê·œì •í‘œ.txt&#39;, &#39;score&#39;: 1.75}, {&#39;rfile_name&#39;: &#39;5_ì¶œí‡´ê·¼ ì‹œìŠ¤í…œ.txt&#39;, &#39;score&#39;: 1.6475}]
            const responseStr = "{{response}}"
            
            // ì›ë˜ ì‘ë‹µ ë¬¸ìì—´ (íŠ¹ìˆ˜ ë¬¸ìê°€ ë³€í™˜ëœ ìƒíƒœ)
            // íŠ¹ìˆ˜ ë¬¸ìë¥¼ ë³µì›í•œ í›„ JSONìœ¼ë¡œ ë³€í™˜
            const responseJSON = responseStr.replace(/&#39;/g, "'").replace(/'/g, '"');
            const response = JSON.parse(responseJSON);

            // íŒŒì‹±ëœ ê°’ì„ í…Œì´ë¸” í˜•ì‹ìœ¼ë¡œ ì¶œë ¥
            let output = "<table border='1' cellpadding='5' cellspacing='0'>";
            output += "<tr><th>ë¬¸ì„œ</th><th>ìœ ì‚¬ë„</th></tr>";
            response.forEach((item, index) => {
                output += "<tr>";
                
                // íŒŒì¼ í™•ì¥ìì— ë”°ë¼ ì•„ì´ì½˜ ê²°ì •
                let fileIcon = "";
                const fileExtension = item.rfile_name.split('.').pop().toLowerCase();
                switch (fileExtension) {
                    case 'txt':
                        fileIcon = "ğŸ“™"; // í…ìŠ¤íŠ¸ íŒŒì¼ ì•„ì´ì½˜
                        break;
                    case 'pdf':
                        fileIcon = "ğŸ“—"; // PDF íŒŒì¼ ì•„ì´ì½˜
                        break;
                    case 'doc':
                    case 'docx':
                        fileIcon = "ğŸ“˜"; // ì›Œë“œ íŒŒì¼ ì•„ì´ì½˜
                        break;
                    case 'ppt':
                    case 'pptx':
                        fileIcon = "ğŸ“•";  // íŒŒì›Œ í¬ì¸íŠ¸ ì•„ì´ì½˜
                        break;
                    default:
                        fileIcon = "ğŸ“„"; // ê¸°ë³¸ íŒŒì¼ ì•„ì´ì½˜
                }

                // íŒŒì¼ëª…ì„ í´ë¦­í•˜ë©´ í•´ë‹¹ íŒŒì¼ë¡œ ì´ë™í•˜ë„ë¡ ë§í¬ ìƒì„±
                output += "<td>" + fileIcon + "<a href='"+ local_folder_path + encodeURIComponent(item.rfile_name) + "' target='_blank'>" + item.rfile_name + "</a></td>";
                output += "<td>" + item.score + "</td>";
                output += "</tr>";
            });
            output += "</table>";

            document.getElementById("docs-manager").innerHTML = output;
        };
    </script>
    <script>
        function openSearchPopup() {
			//const hostname = document.getElementById("hostname").textContent;
			//const port = document.getElementById("port").textContent;
            const filename = document.getElementById("doc-filename").textContent;
            const popupUrl = `http://10.10.4.10:9003/rag?filename=${filename}`;
			
            window.open(popupUrl, 'RAG', 'width=800, height=1000');
        }
    </script>
</head>
<body>
    <div id="doc-filename"></div> <!--íŒŒì¼ëª…-->
    <div id="total-time"></div> <!-- ì‹œê°„, í´ë”ê²½ë¡œ -->
    <div id="doc-answer"></div> <!-- gpt ë¬¸ì„œ ìš”ì•½ -->
    <div id="docs-manager"></div> <!--í‘œ ì¶œë ¥ë¶€ë¶„-->
    <!-- CHAT ë²„íŠ¼(ì±—ë´‡)-->
    <div class="input-container"></div>
        <div style="text-align: center;">
            <button style="width: 400px;" onclick="openSearchPopup()">CHAT</button>
        </div></div>
    </div>
</body>
</html>
